<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourMapper Pro</title>
    <script>
        function uploadFile() {
            let fileInput = document.getElementById("fileInput").files[0];
            if (!fileInput) { alert("No file selected."); return; }
            let formData = new FormData();
            formData.append("file", fileInput);

            fetch("/upload", { method: "POST", body: formData })
                .then(response => response.json())
                .then(data => { 
                    console.log("Upload response:", data);  
                    alert(data.status === 'completed' ? "Upload Successful!" : "Upload Failed!"); 
                    startProcessing();
                })
                .catch(error => console.error("‚ùå Upload Error:", error));
        }

        function startProcessing() {
            let venueAddress = prompt("Enter venue address:");
            if (!venueAddress) { alert("No address provided."); return; }

            console.log("üì© Sending venue address:", venueAddress);

            fetch("/generate_polygons", { 
                method: "POST", 
                headers: { "Content-Type": "application/json" }, 
                body: JSON.stringify({ venue_address: venueAddress }) 
            })
            .then(response => response.json())
            .then(data => { 
                console.log("Processing response:", data);
                if (data.status === "completed") {
                    document.getElementById("downloadButton").style.display = "block";
                } else {
                    alert("‚ùå Error generating polygons: " + data.message);
                }
            })
            .catch(error => console.error("‚ùå Processing Error:", error));
        }

        function downloadGeoJSON() {
            window.location.href = "/download";
        }
    </script>
</head>
<body>
    <h1>TourMapper Pro</h1>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload</button>
    <button id="downloadButton" onclick="downloadGeoJSON()" style="display:none;">Download GeoJSON</button>
</body>
</html>
