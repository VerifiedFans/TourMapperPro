<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourMapper Pro</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #drop-area { border: 2px dashed #ccc; padding: 20px; margin: 20px auto; width: 50%; }
        #progress-bar { width: 50%; height: 20px; background: #ddd; margin: 10px auto; display: none; }
        #progress { height: 100%; background: green; width: 0%; }
    </style>
</head>
<body>

    <h1>TourMapper Pro</h1>

    <!-- File Upload & Copy-Paste -->
    <input type="file" id="file-upload">
    <textarea id="pasted-urls" placeholder="Paste URLs here (one per line)"></textarea>
    <button onclick="uploadUrls()">Upload URLs</button>

    <!-- View & Clear Uploaded Files -->
    <button onclick="viewUploadedFiles()">View Uploaded Files</button>
    <button onclick="clearUploadedFiles()">Clear Files</button>

    <!-- Start Scraping -->
    <button onclick="startScraping()">Start Scraping</button>

    <!-- Progress Bar -->
    <div id="progress-bar"><div id="progress"></div></div>

    <!-- Download Button -->
    <button onclick="downloadGeoJSON()">Download GeoJSON</button>

    <!-- Drag & Drop Upload -->
    <div id="drop-area">Drag & Drop Files Here</div>

    <script>
        function uploadUrls() {
            let fileInput = document.getElementById("file-upload");
            let pastedUrls = document.getElementById("pasted-urls").value;
            let formData = new FormData();

            if (fileInput.files.length > 0) {
                formData.append("file", fileInput.files[0]);
            } else if (pastedUrls.trim() !== "") {
                formData.append("pasted_urls", pastedUrls);
            }

            fetch("/upload", { method: "POST", body: formData })
                .then(res => res.json())
                .then(data => alert("Uploaded successfully!"))
                .catch(err => alert("Upload failed."));
        }

        function viewUploadedFiles() {
            fetch("/view_files")
                .then(res => res.json())
                .then(data => alert("Uploaded URLs:\n" + data.uploaded_urls.join("\n")))
                .catch(err => alert("Failed to retrieve files."));
        }

        function clearUploadedFiles() {
            fetch("/clear_files", { method: "POST" })
                .then(res => res.json())
                .then(data => alert(data.message))
                .catch(err => alert("Clear failed."));
        }

        function startScraping() {
            document.getElementById("progress-bar").style.display = "block";
            document.getElementById("progress").style.width = "0%";

            fetch("/start_scraping", { method: "POST" })
                .then(res => res.json())
                .then(data => {
                    let progress = document.getElementById("progress");
                    let interval = setInterval(() => {
                        fetch("/progress")
                            .then(res => res.json())
                            .then(data => {
                                progress.style.width = data.progress + "%";
                                if (data.progress >= 100) clearInterval(interval);
                            });
                    }, 1000);
                });
        }

        function downloadGeoJSON() {
            window.location.href = "/download";
        }
    </script>

</body>
</html>

