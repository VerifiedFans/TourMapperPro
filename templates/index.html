<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourMapper Pro</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        .container { max-width: 600px; margin: auto; padding: 20px; }
        #dropZone { border: 2px dashed #007bff; padding: 20px; cursor: pointer; margin-bottom: 10px; }
        #progressBar { width: 100%; background: #ccc; height: 20px; display: none; }
        #progressBar div { height: 100%; width: 0%; background: #28a745; }
        #uploadedList { text-align: left; margin-top: 10px; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <img src="/static/logo.png" alt="Logo" width="150">
        <h2>TourMapper Pro</h2>

        <div id="dropZone" onclick="document.getElementById('fileInput').click();">
            Drag & Drop or Click to Upload URLs (CSV/TXT)
        </div>
        <input type="file" id="fileInput" accept=".csv,.txt" multiple style="display: none;">
        <button onclick="viewUploadedFiles()">View Uploaded Files</button>
        <button onclick="clearFiles()">Clear Files</button>
        <button onclick="startScraping()">Start Scraping</button>
        <button id="downloadButton" style="display: none;" onclick="downloadGeoJSON()">Download GeoJSON</button>

        <div id="progressBar"><div></div></div>
        <div id="uploadedList"></div>
    </div>

    <script>
        document.getElementById("fileInput").addEventListener("change", function (event) {
            let files = event.target.files;
            if (files.length > 0) {
                let formData = new FormData();
                for (let file of files) {
                    formData.append("file", file);
                }

                fetch("/upload", { method: "POST", body: formData })
                .then(response => response.json())
                .then(data => {
                    alert("Upload successful!");
                    viewUploadedFiles();
                })
                .catch(error => console.error("Upload error:", error));
            }
        });

        function viewUploadedFiles() {
            fetch("/uploaded_urls")
            .then(response => response.json())
            .then(data => {
                let listHtml = "<h3>Uploaded URLs:</h3><ul>";
                data.urls.forEach(url => {
                    listHtml += `<li>${url}</li>`;
                });
                listHtml += "</ul>";
                document.getElementById("uploadedList").innerHTML = listHtml;
            });
        }

        function clearFiles() {
            fetch("/clear", { method: "POST" })
            .then(response => response.json())
            .then(() => {
                document.getElementById("uploadedList").innerHTML = "";
                alert("Files cleared!");
            });
        }

        function startScraping() {
            document.getElementById("progressBar").style.display = "block";
            let progress = document.getElementById("progressBar").firstElementChild;
            let width = 0;
            let interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                } else {
                    width += 10;
                    progress.style.width = width + "%";
                }
            }, 1000);

            fetch("/start_scraping", { method: "POST" })
            .then(response => response.json())
            .then(data => {
                clearInterval(interval);
                progress.style.width = "100%";
                alert("Scraping complete!");
                document.getElementById("downloadButton").style.display = "block";
            });
        }

        function downloadGeoJSON() {
            window.location.href = "/download";
        }
    </script>

</body>
</html>
     

