<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourMapper Pro</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #drop-area {
            border: 2px dashed #ccc; padding: 20px; width: 50%;
            margin: 20px auto; background-color: #f9f9f9;
        }
        #progress-bar { width: 0%; height: 20px; background: green; }
    </style>
</head>
<body>

    <h1>Welcome to TourMapper Pro</h1>
    <img src="/static/logo.png" alt="Logo" width="150">  

    <div id="drop-area">
        <p>Drag & Drop files here or click to upload</p>
        <input type="file" id="fileInput" multiple>
    </div>

    <button onclick="viewUploadedFiles()">View Uploaded Files</button>
    <button onclick="startScraping()">Start Scraping</button>
    <button onclick="clearUploadedFiles()">Clear Uploaded Files</button>
    
    <div id="uploaded-files"></div>

    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>

    <a id="download-link" style="display:none;" href="/download_geojson" download="events.geojson">
        <button>Download GeoJSON</button>
    </a>

    <script>
        document.getElementById("drop-area").addEventListener("drop", function(event) {
            event.preventDefault();
            let files = event.dataTransfer.files;
            uploadFiles(files);
        });

        document.getElementById("drop-area").addEventListener("dragover", function(event) {
            event.preventDefault();
        });

        document.getElementById("fileInput").addEventListener("change", function(event) {
            uploadFiles(event.target.files);
        });

        function uploadFiles(files) {
            for (let file of files) {
                let formData = new FormData();
                formData.append("file", file);

                fetch("/upload", { method: "POST", body: formData })
                    .then(response => response.json())
                    .then(data => alert(data.message))
                    .catch(error => console.error("Upload error:", error));
            }
        }

        function viewUploadedFiles() {
            fetch("/view_files")
                .then(response => response.json())
                .then(data => {
                    let fileList = document.getElementById("uploaded-files");
                    fileList.innerHTML = "<h3>Uploaded Files:</h3>";
                    data.files.forEach(file => {
                        fileList.innerHTML += `<p>${file}</p>`;
                    });
                })
                .catch(error => console.error("Error fetching files:", error));
        }

        function startScraping() {
            document.getElementById("progress-bar").style.width = "0%";
            let progress = 0;
            let interval = setInterval(() => {
                progress += 10;
                document.getElementById("progress-bar").style.width = progress + "%";
                if (progress >= 100) clearInterval(interval);
            }, 500);

            fetch("/start_scraping", { method: "POST" })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    document.getElementById("download-link").style.display = "block";
                })
                .catch(error => console.error("Error starting scraping:", error));
        }

        function clearUploadedFiles() {
            fetch("/clear_files", { method: "POST" })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    document.getElementById("uploaded-files").innerHTML = "";
                })
                .catch(error => console.error("Error clearing files:", error));
        }
    </script>

</body>
</html>
