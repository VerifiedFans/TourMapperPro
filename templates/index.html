<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload URLs for Processing</title>
    <script>
        function uploadURLs() {
            let urls = document.getElementById('urls').value.split("\n").map(url => url.trim()).filter(url => url);
            if (urls.length === 0) {
                alert("Please enter at least one URL.");
                return;
            }

            document.getElementById('progress').innerText = "Processing...";

            fetch('/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ urls: urls })
            })
            .then(response => response.json())
            .then(data => {
                if (data.task_id) {
                    checkStatus(data.task_id);
                } else {
                    alert("Error: " + JSON.stringify(data));
                }
            });
        }

        function checkStatus(taskId) {
            fetch(`/task-status/${taskId}`)
            .then(response => response.json())
            .then(data => {
                if (data.state === "PROGRESS") {
                    document.getElementById('progress').innerText = `Processing: ${data.progress.current} / ${data.progress.total}`;
                    setTimeout(() => checkStatus(taskId), 2000);
                } else if (data.state === "SUCCESS") {
                    document.getElementById('progress').innerText = "Processing complete!";
                    document.getElementById('download').innerHTML = `<a href="/download/${data.geojson_file.split('/').pop()}">Download GeoJSON</a>`;
                } else {
                    document.getElementById('progress').innerText = "Error or unknown status.";
                }
            });
        }
    </script>
</head>
<body>
    <h2>Upload URLs for Processing</h2>
    <textarea id="urls" rows="5" cols="50" placeholder="Enter URLs, one per line..."></textarea>
    <br>
    <button onclick="uploadURLs()">Upload & Process</button>
    <p id="progress"></p>
    <div id="download"></div>
</body>
</html>
