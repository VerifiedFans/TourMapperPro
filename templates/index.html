
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourMapper Pro</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #drop-area { border: 2px dashed #ccc; padding: 20px; margin: 20px auto; width: 50%; }
        #progress-bar { width: 50%; height: 20px; background-color: #ddd; margin: 10px auto; display: none; }
        #progress { height: 100%; width: 0%; background-color: green; }
        #file-list { text-align: left; margin: 10px auto; width: 50%; }
        button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>

    <h1>TourMapper Pro</h1>
    <img src="static/logo.png" alt="Logo" width="200">

    <!-- Drag & Drop Area -->
    <div id="drop-area">
        <p>Drag & Drop files here or <input type="file" id="fileInput"></p>
    </div>

    <!-- Progress Bar -->
    <div id="progress-bar"><div id="progress"></div></div>

    <!-- Buttons -->
    <button onclick="viewFiles()">View Uploaded Files</button>
    <button onclick="startScraping()">Start Scraping</button>
    <button onclick="clearFiles()">Clear Uploaded Files</button>
    <a id="download-btn" href="#" style="display: none;" download="events.geojson">Download GeoJSON</a>

    <!-- Uploaded Files List -->
    <ul id="file-list"></ul>

    <script>
        const dropArea = document.getElementById("drop-area");
        const fileInput = document.getElementById("fileInput");
        const progressBar = document.getElementById("progress-bar");
        const progress = document.getElementById("progress");
        const fileList = document.getElementById("file-list");
        const downloadBtn = document.getElementById("download-btn");

        // Drag & Drop Upload
        dropArea.addEventListener("dragover", (event) => {
            event.preventDefault();
            dropArea.style.borderColor = "blue";
        });

        dropArea.addEventListener("dragleave", () => {
            dropArea.style.borderColor = "#ccc";
        });

        dropArea.addEventListener("drop", (event) => {
            event.preventDefault();
            dropArea.style.borderColor = "#ccc";
            uploadFile(event.dataTransfer.files[0]);
        });

        fileInput.addEventListener("change", () => {
            uploadFile(fileInput.files[0]);
        });

        function uploadFile(file) {
            const formData = new FormData();
            formData.append("file", file);

            fetch("/upload", { method: "POST", body: formData })
                .then(res => res.json())
                .then(data => { alert(data.message); viewFiles(); })
                .catch(err => console.error(err));
        }

        function viewFiles() {
            fetch("/view_files")
                .then(res => res.json())
                .then(data => {
                    fileList.innerHTML = "";
                    data.files.forEach(file => {
                        const li = document.createElement("li");
                        li.textContent = file;
                        fileList.appendChild(li);
                    });
                });
        }

        function startScraping() {
            progressBar.style.display = "block";
            progress.style.width = "0%";

            fetch("/start_scraping", { method: "POST" })
                .then(res => res.json())
                .then(data => {
                    progress.style.width = "100%";
                    alert(data.message);
                    if (data.geojson_file) {
                        downloadBtn.href = `/download_geojson`;
                        downloadBtn.style.display = "inline";
                    }
                });
        }

        function clearFiles() {
            fetch("/clear_files", { method: "POST" })
                .then(res => res.json())
                .then(data => { alert(data.message); viewFiles(); })
                .catch(err => console.error(err));
        }
    </script>

</body>
</html>
